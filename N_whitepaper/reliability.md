# 10 平台可靠性

平台可靠性通过数据中心、硬件设施、云平台软件、云平台服务及云平台升级等多维度高可用设计保证平台整体可靠性，进一步保证用户业务连续性。

## 10.1 数据中心

**(1)**  **双活数据中心**

平台具备多数据中心部署和统一管理能力，采用两个相互独立、互为备份的数据中心，可理解为在两个数据中心采用一套集群统一建设一套私有云平台，并共享一个互联网/企业内网出口。

当一个数据中心出现故障或宕机，可在另一个数据中心之间进行实时数据同步和故障切换，避免业务系统因单点故障而中断，确保业务任何情况都能保持稳定运行。同时双活数据中心具备高度的可扩展性，可根据客户的需求进行自定义配置和扩容，满足不同业务场景下的需求。

通过平台提供的双活数据中心能力，快速实现业务跨数据中心的故障转移保障机制，提升系统可靠性和连续性，助力企业在数字化转型中创造优质价值。

**(2)**  **异地容灾**

在数据中心维度支持容灾方案，根据不同容灾等级的需求，分别通过专线、SD-WAN、VPN、互联网等互联多个异地数据中心。将业务和数据按需求部署或异地复制到异地数据中心，并通过智能 DNS 进行异地数据中心的业务切换。

**(3)**  **机柜级冗余**

网络设备和服务器硬件设备均对称部署于机柜，如 3 台计算节点服务器分别对称部署于 3 个机柜，一个机柜一台服务器，单机柜掉电或故障不影响业务正常运行和使用。

## 10.2 硬件设施

**(1)**  **内外网物理隔离**

内网业务和外网业务在物理网络设备上完全隔离，避免内外网业务相互影响。内网和外网分别使用独立的网络交换机设备，每台服务器提供内网网卡和外网网卡，分别接入至内网交换机和外网交换机。

**(2)**  **网络设备高可用**

* **网络设备扩展**：网络设备扩展性设计，所有网络设备分为核心和接入两层架构，一套核心可水平扩展几十套接入设备。

* **网络设备冗余**：网络设备冗余性设计 ，所有网络设备均为一组两台堆叠，避免交换机单点故障，实现交换机级别高可用。

* **网络接入冗余**：交换机下联接入冗余性设计，所有服务器双上联交换机的接口均做 LACP 端口聚合，避免单点故障，实现交换机互联高可用。

**(3)**  **服务器高可用**

* **接入层冗余**：服务器网络接入冗余性设计，所有服务器节点均做双网卡绑定，分别接入内网交换机和外网交换机，避免单点故障，实现服务器网络接入高可用。

* **管理节点冗余**：管理节点冗余性和扩展性设计，多台管理节点分布式部署，并支持横向扩展，避免管理节点单点故障，实现管理服务高可用。

* **计算节点高可用**：云平台通过智能调度系统将虚拟机均衡部署于计算节点，可水平扩展计算节点数量。支持虚拟机在线迁移、故障转移、智能均衡部署，实现计算节点高可用及虚拟机高可用。

* **分布式存储节点**：分布式存储冗余性设计，将数据均衡存储于所有磁盘，并通过三副本保证数据安全。数据及副本可放置于不同机柜、不同节点及不同磁盘上，尽可能保证数据安全性；同时分布式存储服务器本身提供冗余性负载设计，节点损坏不影响分布式存储使用并不会丢失数据。

## 10.3 云平台软件

* **分布式调度**：基于分布式服务调用和远程服务调用为租户提供智能调度模块。智能调度模块实时监测集群和所有服务节点的状态和负载，当某集群扩容、服务器故障、网络故障及配置发生变更时，智能调度模块可根据隔离组自动迁移被虚拟资源到健康的服务器节点，保证云平台的高可靠性和高可用性。

* **分布式网络：**1）云平台采用分布式Overlay网络部署模式，所有的虚拟网络均部署于所有计算节点，管理节点仅作为管理角色，不承担网络组件部署及生产网络传输，所有生产网络仅在计算节点上传输，无需通过管理节进行转发。分布式存储直接通过物理网络进行挂载，无需通过虚拟网络进行挂载和传输，虚拟化与存储通过本机或跨物理机内网进行通信。2）分布式网络架构将业务数据传输分散至各个计算节点，除业务逻辑等北向流量需要管理节点服务外，所有虚拟化资源的业务实现等南向流量均分布在计算节点或存储节点上，即平台业务扩展并不受管理节点数量限制。

* **资源管理**：通过分布式资源管理模块，负责集群计算、存储、网络等资源的分配及管理，为云平台租户提供资源配额、资源申请、资源调度、资源占用及访问控制，提升整个集群的资源利用率。

* **安全管理**：为租户提供身份认证、授权机制、访问控制等功能。通过API密钥对和用户名密码等多种方式进行服务间调用及用户身份认证；通过角色权限机制进行用户对资源访问的控制；通过VPC隔离机制和安全组对资源网络进行访问控制，保证平台的安全性。

* **集群部署**：提供自动化部署集群节点的模块，为运维人员提供集群部署、配置管理、集群管理、集群扩容、在线迁移及服务节点下线等功能，为平台管理者提供自动化部署通道。

* **集群监控**：提供平台集群物理资源和虚拟资源信息收集、监控及告警。通过自动化获取资源的运行状态信息，并将信息指标化展示给用户；同时提供监控告警规则，通过配置告警规则，对集群的状态事件进行监控及报警，并有效存储监控报警历史记录。

* **业务实现分离**：云平台架构从业务逻辑上分为北向接口和南向接口，将云平台的业务逻辑和业务实现进行分离，业务管理逻辑不可用时，不影响虚拟资源的正常运行，整体提升云平台业务可用性和可靠性。业务实现分离后，云平台服务管理部署在独立资源池中，当云平台业务端（如 WEB 控制台）发生故障时，并不影响已运行在云平台上的虚拟机及运行在虚拟机中的业务，一定程度上保证业务高可用。

* **云平台升级**：云平台支持在线扩展计算节点，并支持平滑升级所有服务，保证平台扩容时的业务可用性。支持云平台跨版本无损升级，提供升级引擎，同时升级过程中无需手工干预，业务应用可自动完成热迁移。各云服务组件之间松耦合，单云服务组件升级对其他云服务和管理平台无影响。

## 10.4 云平台服务

**(1)**  **弹性计算**

* **智能调度**：智能调度优先选择低负荷节点进行虚拟资源部署，并提供打散部署、在线迁移、离线迁移及宕机迁移等能力，整体保证云平台的可靠性。

* **部署策略**：将多个虚拟机加入隔离组，用于控制云主机的分布以保证业务高可用性。可自定义虚拟机与其他虚拟机或宿主机之间的亲和关系。支持亲和性和反亲和性两种策略类型，可有效提高业务服务的可用性。

* **自制镜像**：自制镜像由云平台用户通过虚拟机自行导出的自有镜像，可用于创建虚拟机，提高平台虚拟机资源的可用性。

**(2)**  **网络服务**

* **二层隔离**：私有网络是一个属于用户的、逻辑隔离的二层网络广播域环境。私有网络是子网的容器，不同私有网络之间是绝对隔离的，保证网强的安全性。

* **NAT网关**：云平台提供NAT网关，是一种网络地址转换协议的VPC公网网关，为云平台资源提供NAT代理（SNAT、DNAT），通过NAT网关可以让VPC子网中未绑定弹性IP的虚拟机访问外网，同时可配置端口转发规则使虚拟机对外提供服务，从网络层面为云平台提供高可用机制。

* **安全组**：提供出入双方向流量访问控制规则，定义哪些网络或协议能访问资源，用于限制虚拟资源的网络访问流量，为云平台提供必要的安全保障。

* **负载均衡**：通过平台负载均衡服务提供的虚拟服务地址，将同一种业务应用虚拟构建为一个高性能、高可用、高可靠的应用服务器池，支持轮询、加权轮询、最小连接数和源基于源地址的的负载调度算法，并根据负载均衡的转发规则，将来自客户端的请求均衡分发给服务器池中最优的虚拟机进行处理，并支持会话保持和健康检查，自动检测并隔离服务不可用的实例，迅速将故障虚拟机进行切换，确保业务服务的可用性。

**(3)**  **弹性存储**

* **分布式统一存储**：云硬盘采用大规模分布式存储系统，将整个计算&存储集群中的存储资源虚拟化后，整合在一起对外提供统一的存储服务。分布式存储系统通过三副本、写入确认机制及副本分布策略等措施，最大限度保障数据安全性和可用性。

* **三副本冗余**：用户通过虚拟机应用程序写入云硬盘的数据，会根据分布式存储系统三副本机制存储三份，并按照副本分布算法，分别存储于不同物理主机的磁盘上。三副本机制存储数据，将自动屏蔽软硬件故障，磁盘损坏和软件故障，导致副本数据丢失，系统自动检测到并自动进行副本数据备份和同步，不会影响业务数据的存储和读写，保证数据安全性和可用性。

* **写入确认机制**：三副本在写入过程中，只有三个写入过程全部被确认，才返回写入完成，确保数据写入的强一致性。

* **数据分布策略**：支持副本数据落盘分布策略，可将三副本数据分布在不同磁盘、不同主机、不同机柜甚至不同机房，避免因单主机及单机柜整体故障造成数据丢失或不可用的故障，保证数据的可用性和安全性。为保证云硬盘数据访问时延，通常建议最多将数据副本保存至不同的机柜，若将数据三副本保存至不同的机房，由于网络延时等原因，可能会影响云硬盘的 IO 性能。

**(4)**  **日志和监控**

* **操作日志**：云平台提供资源级别操作日志及平台组件化系统操作日志，记录云平台所有操作信息，方便定位故障及相关平台运营信息。

* **审计日志**：提供云平台所有登陆登出操作审计信息，包括租户及管理员平台登录登出的信息。

* **资源事件**：平台提供核心资源的部分操作及状态进行记录及通知，如资源生命周期状态的变化、操作运维执行情况等。

* **监控告警**：平台全线产品的运维监控及告警服务，提供全线资源实时监控数据及图表信息，可根据监控数据批量为资源设置告警策略，并在资源故障或监控指标超过告警阈值时，以邮件的方式给予通知及预警，全方位保障业务的可靠性和安全性。

**(5)**  **PaaS服务高可用**

* **NAT网关**：NAT网关实例支持高可用架构，即至少由2个虚拟机实例构建，支持双机热备。当一个NAT网关的实例发生故障时，支持自动在线切换到另一个虚拟机实例，保证NAT代理业务正常。同时基于外网IP地址的漂移特性，支持在物理机宕机时，保证SNAT网关出口及DNAT入口的可用性。

* **负载均衡**：支持负载均衡主备版，满足负载均衡网关高可用场景。当其中一个负载均衡的虚拟机实例因故障宕机时，备实例会自动转换为主实例持续提供负载均衡服务。

* **VPN网关**：支持VPN网关主备版，满足VPN网关高可用场景。当其中一个网关的虚拟机实例因故障宕机时，备实例会自动转换为主实例持续提供VPN网关的通信服务。

* **MySQL服务：**支持MySQL服务主备版，满足MySQL服务高可用场景。当其中一个MySQL实例因故障宕机时，备实例会自动转换为主实例持续提供MySQL数据库服务。

* **Redis服务**：支持Redis服务主备版，满足Redis服务高可用场景。当其中一个Redis实例因故障宕机时，备实例会自动转换为主实例持续提供Redis缓存服务。

* **对象存储**：支持对象存储服务主备版，满足对象存储服务高可用场景。当其中一个对象存储实例因故障宕机时，备实例会自动转换为主实例持续提供对象存储服务。

* **文件存储**：支持文件存储服务主备版，满足文件存储服务高可用场景。当其中一个文件存储实例因故障宕机时，备实例会自动转换为主实例持续提供文件存储服务。

**(6)**  **资源配额**

* 支持云平台全局配置每种资源的配额，防止资源利用溢出，导致云平台业务不可用，优先保证重要业务的资源分配和使用。

* 支持用户及子帐号级别的资源配额定义，优先保证线上帐号资源分配和使用。

