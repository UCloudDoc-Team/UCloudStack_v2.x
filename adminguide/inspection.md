# 13 一键巡检

##  13.1 一键巡检 简介

### 13.1.1 概述

一键巡检，是用来检查云平台的健康情况，通过对管理节点、计算节点的巡检项进行扫描。

### 13.1.2 一键巡检内容

巡检主要是对平台进行全面扫描，包括管理节点的时间源同步检查、CPU使用率、内存使用率检查、磁盘使用率检查；计算节点的物理机CPU平均使用率检查、物理机内存使用率检查、物理机系统盘已用容量检查，详细的巡检列表如下：

| 巡检类型 | 巡检项                   | 巡检项含义                                                       | 结果展示                                                    | 巡检建议                                                                                                                              |
|----------|-----------------------|-------------------------------------------------------------|---------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| 管理节点 | 时间源一致性检查         | 检查是否设置时间源同步以及时间源设置是否与集群内其他管理节点一致 | 提供节点当前时间源，和推荐时间源                             | 若检测到时间源与集群内其他节点时间源不一致或物理机系统时钟未与时间源同步，请SSH登录对应系统，检查时间源配置                             |
|          | CPU使用率检查            | 检查云平台管理节点CPU的使用占比                                  | 提供当前占比，若超过80%，提供最高使用率的五个进程             | 若检测到云平台CPU使用率在10分钟内持续的超过80%的使用率，请尽快联系平台相关人员进行热升级或问题评估，以继续正常使用本平台功能            |
|          | 内存使用率检查           | 检查云平台管理节点内存的使用占比                                 | 提供当前占比，若超过80%，提供最高使用率的五个进程             | 若检测到云平台内存使用率在10分钟内持续的超过80%的使用率，请尽快联系平台相关人员进行热升级或问题评估，以继续正常使用本平台功能           |
|          | 磁盘容量检查             | 检查云平台管理节点磁盘的使用占比                                 | 提供当前占比，若超过70%，提供占比最高的十个文件路径和文件大小 | 若检测到云平台磁盘数据容量已占用管理节点所在磁盘超过70%的容量，请尽快联系平台相关人员进行磁盘检查和扩容，以继续正常使用本平台功能       |
| 计算节点 | 物理机CPU平均使用率检查  | 检查云平台上物理机CPU平均使用率                                  | 提供当前占比，若超过80%，提供最高使用率的五个进程             | 若检测到物理机CPU平均使用率超过70%，请登录物理机系统，确认物理机上是否存在异常进程。若未存在异常进程，建议考虑对集群进行扩容              |
|          | 物理机内存使用率检查     | 检查云平台上物理机内存平均使用率                                 | 提供当前占比，若超过80%，提供最高使用率的五个进程             | 若检测到物理机内存使用率超过80%甚至90%，请立即登录物理机系统，检查物理机上是否存在业务异常，并按需优化运行业务。必要时，建议对集群进行扩容 |
|          | 物理机系统盘已用容量检查 | 检查云平台上物理机系统盘使用率和使用量                           | 提供当前占比，若超过70%，提供占比最高的十个文件路径和文件大小 | 若检测到物理机系统盘容量使用率超过70%甚至90%，请立即登录至物理机系统，检查并清理对业务无影响的数据                                      |

## 13.2 创建一键巡检

云平台用户可通过 API 接口或控制台创建高可用VIP，用于服务的高可用，创建高可用VIP前需保证账户至少拥有一个 VPC 网络和子网。通过导航栏进入虚拟机控制台，切换至【VIP】管理页面，点击“新建”按钮进入高可用VIP创建向导弹窗，如下是创建高可用VIP的示意图:

![createinspection](../images/userguide/createinspection.png)

* 名称/备注：申请高可用VIP 的名称和备注，申请时必须指定名称。
* 所属网络：高可用VIP的所属网络，创建时必须指定。
* IP 地址：用户手动指定 IP 地址申请HAVIP，指定的 IP 地址必须在所选网段的 IP 范围内。
* 关联虚拟机：用户可以选择所属vpc下的虚拟机，并绑定HAVIP。
  * 单VIP可绑定虚拟机不超过3台
  * 一台虚拟机只能绑定五个vip
* 确认创建：点击确认后，会返回 HAVIP 资源列表页，在列表页可查看 HAVIP 的资源状态，通常创建成功后会显示“可用”的状态，如果因为某些原因没有创建成功会显示”失败“的状态。

## 13.3 查看一键巡检 
通过导航栏进入虚拟机控制台，切换至VIP管理页面可查看高可用VIP资源的列表及相关信息，包括高可用VIP的名称备注、资源 ID、状态、vpc子网、IP 地址、关联资源、项目组、创建时间及操作项

## 13.3.1 一键巡检列表 
修改HAVIP的名称和备注，在任何状态下均可进行操作。可通过VIP列表页面每个HAVIP名称右侧的“编辑”按钮进行修改；更新关联虚拟机，可以替换、删除、新增虚拟机，关联虚拟机数量不可超过3台，如图所示：

![inspectionlist](../images/userguide/inspectionlist.png)

## 13.3.2 一键巡检详情
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![inspectiondetails](../images/userguide/inspectiondetails.png)

## 13.3.3 时间源同步检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![timesource](../images/userguide/timesource.png)

## 13.3.4 CPU使用率
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![CPUusage](../images/userguide/CPUusage.png)

## 13.3.5 内存使用率检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![memoryusage](../images/userguide/memoryusage.png)

## 13.3.6 磁盘使用量检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![diskusage](../images/userguide/diskusage.png)

## 13.3.7 物理机CPU平均使用率检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![machineCPU](../images/userguide/machineCPU.png)

## 13.3.8 物理机内存使用率检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![machinememory](../images/userguide/machinememory.png)

## 13.3.9 物理机系统盘已用容量检查
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![systemdisk](../images/userguide/systemdisk.png)

## 13.4 下载巡检报告
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![downloadinspection](../images/userguide/downloadinspection.png)

## 13.5 删除巡检报告
支持用户删除高可用VIP资源，可支持删除【可用】【失败】状态的高可用VIP。删除弹性网卡后，会自动解绑与之关联的虚拟机。用户可通过VIP列表进行高可用VIP的删除操作，支持批量删除。

![deleteinspection](../images/userguide/deleteinspection.png)