# 5 物理资源管理

平台为管理员提供全平台所有物理资源的生命周期管理和运维能力，使平台管理员可通过控制台统一管控运行云平台的整体物理资源，包括物理机资源（宿主机）、物理机纳管、镜像资源及外网网段资源。

## 5.1 宿主机管理

宿主机管理是指对地域内的所有计算节点的管理，包括查看宿主机、锁定、解锁、进入维护模式、退出维护模式等，同时可查看每个计算节点中已存在的计算实例。

### 5.1.1 查看宿主机列表

管理员可在计算资源/宿主机页面查看地域下所有宿主机节点列表及相关信息，包括宿主机 ID、宿主机 IP、计算集群 ID、CPU 型号、总核数、已分配核数、总内存、已分配内存、更新时间及操作项，如下图所示：

![computenode](../images/adminguide/computenode.png)

- 宿主机 ID：计算节点在平台的唯一标识符。
- 宿主机 IP：计算节点的 IP 地址。
- 计算集群 ID：计算节点所属计算集群的 ID。
- CPU 型号：计算节点的 CPU 类型，如 Intel、AMD 等。
- 总核数：计算节点的总 vCPU 核数。
- 已分配核数：计算节点中已分配的核数。
- 总内存：计算节点的总内存容量，如 256GB。
- 已分配内存：计算节点中已分配的内存容量。
- 更新时间：计算节点的更新时间。
- 状态：计算节点的运行状态，包括可用、已锁定、进入维护模式中、维护模式。
  - 可用：代表计算节点可提供计算服务，计算实例会被调度并部署至宿主机。
  - 已锁定：代表计算节点已被锁定，新建计算实例不会被调度至计算节点，不影响节点内已有计算实例。
  - 进入维护模式中：代表计算节点正在进入维护模式中，即宿主机上的虚拟资源将被自动迁移到同计算集群的其他节点，使计算节点进入维护模式。
  - 维护模式：代表计算节点上的所有计算实例已被迁移至同集群其它节点并已正常进入维护模式，可对节点进行维护，如扩展内存、升级、修复硬件等。

管理员可在列表上对每台计算节点进行锁定、解锁、进入维护模式、退出维护模式等操作，以方便对计算节点进行维护；同时支持对宿主机节点进行搜索，支持模糊搜索。

### 5.1.2 查看宿主机详情

管理员可在宿主机列表中，通过目标宿主机器名称进入宿主机器详情页面，查看宿主机的基本信息及监控信息，同时可查询计算节点已运行的计算实例，如下图所示：

![computenodeinfo](../images/adminguide/computenodeinfo.png)

**（1）基本信息**

包括宿主机 ID、宿主机 IP 地址、集群 ID、CPU 类型、状态、总核数、已分配核数、总内存、已分配内存及更新时间。

**（2）监控信息**

支持查看宿主机器的监控信息，包括：网卡入带宽、网卡出带宽、硬盘读吞吐、硬盘写吞吐、平均负载、内存使用率、空间使用率、硬盘读此书、网卡入包量、硬盘写次数、网卡出包量、CPU 使用率、TCP 连接数、阻塞进程数。

**（3）计算实例**

支持管理员通过宿主机详情页面，查看宿主机中的计算实例列表及信息，包括名称、计算实例 ID、资源 ID、所属租户、宿主机 IP、镜像 ID、GPU、CPU、内存、状态、创建时间及更新时间，并支持对计算实例进行搜索，支持模糊搜索，如下图所示：

![nodeinstance](../images/adminguide/nodeinstance.png)

计算实例包括虚拟机的实例，同时也包括平台网关及 PaaS 产品的实例，可通过实例名称及资源 ID 进行区分。

**（4）USB设备管理**

支持管理员通过宿主机页面，查看宿主机中USB设备列表及信息，包括设备名、设备ID、状态、厂商、类型、序列号、虚拟机、USB版本、所属租户，并支持对USB进行分配，如下图所示：

![nodeinstance](../images/adminguide/usb.png)

**（5）GPU管理**

支持管理员通过宿主机页面，查看宿主机中GPU设备列表及信息，包括设备名、规格信息、设备地址、类型、状态、操作，如下图所示：

![nodeinstance](../images/adminguide/GPU.png)

支持管理员对宿主机中GPU设备进行虚拟化切割，并在vGPU中展示设备信息，包括设备名、规格信息、物理GPU、云主机、状态，如下图所示：

![nodeinstance](../images/adminguide/sliceGPU.png)

![nodeinstance](../images/adminguide/vGPU.png)

支持管理员对宿主机中已虚拟化切割的GPU设备进行虚拟化还原，如下图所示：

![nodeinstance](../images/adminguide/reGPU.png)

### 5.1.3 锁定宿主机

宿主机被锁定后，新建计算实例不会被调度至计算节点，不影响节点内已有计算实例，可配合宿主机进入维护模式功能，以实现宿主机维护、升级等操作。

![lock](../images/adminguide/lock.png)

仅支持宿主机在【可用】状态下进行锁定操作，锁定宿主机后，宿主机的状态即流转为【已锁定】，在已锁定状态下新的虚拟机实例不会被创建至节点，同时可在已锁定状态下使计算节点进入维护模式。

> 锁定宿主机为敏感操作，可能导致租户创建资源失败，操作前需确认平台有足够的资源。

### 5.1.4 解锁宿主机

管理员将锁定的宿主机进行解锁，可对外提供计算服务，计算实例可被调度并部署至宿主机。

![unlock](../images/adminguide/unlock.png)

仅支持宿主机在【已锁定】状态下进行解锁操作，解锁后宿主机的状态即流转为【可用】，在可用状态下计算实例会被调度并创建至节点。

### 5.1.5 进入维护模式

当需要维护宿主机时，比如扩展内存、升级、修复硬件等维护场景下，平台支持将宿主机进入维护模式，使宿主机上的虚拟资源自动迁移至同计算集群中其他物理节点上，使节点处于空闲状态，确保对物理节点维护时不影响平台的虚拟资源运行，保证业务的可用性。

宿主机进入维护模式前必须保证节点状态为已锁定，即需要将宿主机进行锁定，才可进行【进入维护模式】的操作，如下图所示：

![maintenance](../images/adminguide/maintenance.png)

管理员将宿主机锁定并进入维护模式前，需请执行以下检查：

* 宿主机上是否有不可迁移的资源，如 GPU 虚拟机或处于中间状态的虚拟机。
* 若存在不可迁移的资源，宿主机器可进入进入维护模式，但中间状态的虚拟机和GPU虚拟机无法被迁移成功。
* 集群内空闲资源是否足够迁移当前宿主机的所有计算实例。

确保宿主机可进入维护模式时，可通过宿主机列表操作项进行操作，具体步骤如下：

1. 选择目标宿主机器，点击右侧“锁定”按钮，使宿主机进入已锁定状态；

2. 点击“进入维护模式”按钮，将宿主机器进入到维护模式，宿主机将自动流转为“进入维护模式中”状态，如下图所示：

   ![inmaintain](../images/adminguide/inmaintain.png)

3. 系统会自动执行在线迁移功能，将此宿主机器上的资源随机迁移至本计算集群中其他合适的宿主机节点，关机状态的计算实例在下次启动后会自动调度至其它宿主机。

4. 待所有虚拟计算实例被迁移至其它节点后，宿主机节点将自动进入【维护模式】状态。

> 如果宿主机器上有无法被成功迁移的资源，进入维护模式将被中断，宿主机器将停留在锁定状态。您可以继续执行宿主机进入维护模式操作，再次尝试迁移未被成功迁移的资源。

### 5.1.6 退出维护模式

退出维护模式是指将宿主机重新加入至调度系统，为平台提供计算能力。仅支持状态为【维护模式】的宿主机退出维护模式，退出维护模式，宿主机将会自动恢复并进入至锁定状态，需进行解锁才可加入智能调度系统以提供计算能力。

平台管理员可通过宿主机节点列表操作项中的【退出维护模式】按钮进行操作，如下图所示：

![outmaintain](../images/adminguide/outmaintain.png)

退出维护模式后，宿主机节点的状态会自动流转为【已锁定】状态，需通过解锁操作使宿主机可正常提供服务。

## 5.2 物理机纳管

### 5.2.1 概述

物理机纳管（Physical Mechanical Nanotube）为用户提供统一纳管存量物理机能力的服务，用户在控制台即可对已纳管的物理机进行电源管理、访问远程控制台和查看硬件监控等基础运维操作。

### 5.2.2 使用流程

在使用物理机纳管服务前，必须提前准备好物理机设备，并根据需求将物理机服务器的 IPMI 网络及业务网络与平台网络进行打通，在通过平台录入设备信息，将设备添加给租户管理。物理机纳管服务的使用流程分为【平台管理员流程】和【租户流程】两大部分，具体如下：

1. **硬件环境装备**

   准备好硬件环境，配置物理网络交换机及服务器 IPMI 网络，使平台物理网络与 IPMI 网络可互相通信。

2. **为租户添加物理机**

   由【平台管理员】为租户添加物理机信息，包括服务器的名称、IPMI IP、IPMI User、IPMI PassWord、机架位置及标签，支持批量导入物理机信息。

3. **租户添加物理机**

   由【平台租户】通过控制台物理机功能，根据需求自主添加物理机，包括服务器的名称、IPMI IP、IPMI User、IPMI PassWord、机架位置及标签，支持批量导入物理机信息。

4. **物理机纳管管理**

   由【平台租户】对已申请的物理机进行全生命周期管理，支持开启、关机、重启、准备控制台、控制台登录、释放控制台、强制关机、关机并重新开机、更新物理机及删除，删除后的物理机可重新添加指定租户管理。

平台租户在使用物理机纳管服务的前提是物理机准备好并添加给租户，租户在控制台即可对已纳管的物理机进行电源管理、访问远程控制台和查看硬件监控等基础运维操作。

### 5.2.3 物理机纳管管理

平台管理员可对物理机进行全生命周期管理，包括添加物理机、查看物理机、删除物理机等，通过一系列配置后租户通过控制台即可对已纳管的物理机进行电源管理、访问远程控制台和查看硬件监控等基础运维操作。

#### 5.2.3.1 添加物理机

在平台已提供物理机纳管服务时，管理员可在平台上为租户添加物理机进行管理，如下图所示：

![createbms](../images/adminguide/createbms.png)

* 租户邮箱：添加物理机的租户邮箱。
* 名称：指物理机在平台的名称标识，添加时必须指定。
* IPMI IP：指物理机的 IPMI IP 地址，添加时必须指定，IP 地址必须从平台可达。
* IPMI User：物理机的 IPMI 用户名，添加时必须指定。
* IPMI PassWord：物理机的 IPMI 密码，添加时必须指定。
* 机架位置：物理机所处的机架位置，添加时必须指定。
* 标签：物理机的标签。

管理员添加提交后列表将生成一条【资源准备中】的物理机信息，待添加成功后，会置为【运行】状态，此时租户可对物理机进行管理。

物理机在准备中状态时无法进行修改操作，包括修改物理机开关机状态、修改物理机控制台状态及更新物理机信息，待物理机进入【运行】状态时可进入物理机详情页面，查看物理机的基本信息和配置信息，包括 CPU信息、内存信息及PCIE信息。

#### 5.2.3.2 批量导入物理机

为方便运维人员快捷添加物理机，平台提供批量导入物理机的能力，可根据平台规范上传 CSV 格式的表格文件，批量导入一批物理机，如下图所示：

![importbms](../images/adminguide/importbms.png)

仅支持 CSV 格式且按照平台规范的文件，可参考【物理机列表示例】文件进行表格制作，表格中的信息包括 Name、IPMIIP、IPMIUsername、IPMIPassword、RackLocation 及 Label ，分别代表物理机名称、IPMI IP 地址、IPMI 用户名、IPMI 密码、机架位置及标签，如下图所示：

![bmcsr](../images/adminguide/bmcsr.png)

批量导入的物理机和手动添加的物理机一致，均会进行初始化准备工作，并将物理机最终置为【已就绪】状态，若物理机一直在准备中，需要登录 IPMI 系统查看物理机的网络及相关配置是否准确。

#### 5.2.3.3 查看物理机

物理机添加后，管理员可通过物理机列表查看物理机的相关信息，包括名称、资源 ID、状态、SN、IPMI IP、所属租户、机型、机架位置、电源、KVM状态、创建时间及操作项，如下图所示：

![bmslist](../images/adminguide/bmslist.png)

* 资源 ID/名称： 为物理机添加至平台后的唯一标识符和名称。
* 所属租户：代表申请该台物理机的租户，未被申请的物理机租户为空。
* 状态：物理机的状态信息，包括资源准备中、运行、失败。
  * 资源准备中：指物理机添加后平台对物理机的初始化及准备工作。
  * 运行：指物理机添加成功，可被租户纳管。
  * 失败：指物理机添加失败，可进行删除物理机。

管理员可通过列表上的操作项对物理机进行开启、关机、重启、准备控制台、控制台登录、释放控制台、强制关机、关机并重新开机、更新物理机及删除等操作，同时支持通过列表对物理机进行批量移除，方便运维操作。管理员也可通过物理机名称进入物理机的详情页面，查看物理机的基本信息和配置信息，包括 CPU信息、内存信息及PCIE信息。，如下图所示共分为基本信息和配置信息：

![bmsinfo1](../images/adminguide/bmsinfo1.png)

![bmsinfo2](../images/adminguide/bmsinfo2.png)

**（1）基本信息**

基本信息展示物理机的相关信息，包括资源 ID、名称、IPMIIP、SN及电源状态。

**（2）CPU信息**

CPU信息展示物理机的型号、核心、稳定功率、一级缓存（KB）、二级缓存（KB）、三级缓存（KB）。

**（3）内存信息**

内存信息展示物理机内存的厂家、序列号、容量（GB）、速度（MHZ）。

#### 5.2.3.4 更新物理机

物理机添加后，支持管理员修改物理机的机架位置和标签，如下图所示：

![upbms](../images/adminguide/upbms.png)

#### 5.2.3.5 删除物理机

平台支持管理员删除物理机资源，如下图所示：

![rmbms](../images/adminguide/rmbms.png)

删除物理机后，租户无法管理物理机，但不影响物理机本身的正常运行。

## 5.3 镜像管理

镜像是虚拟机所使用的镜像模板文件，如 CentOS、Windows、Ubuntu 、Debian等操作系统模板文件，平台的镜像文件均为 QCOW2 格式。镜像管理是平台为虚拟机提供的镜像仓库，支持基础镜像和自制镜像两种类型：

- 基础镜像是由平台官方默认提供，包括多发行版 Centos 、Debian、Ubuntu 及 Windows 等原生操作系统；
- 自制镜像由租户或管理员通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，除平台管理员外仅账号自身有权限查看和管理。

### 5.3.1 基础镜像管理

平台默认会提供多发行版 Centos 、Debian、Ubuntu 及 Windows 等原生操作系统的基础镜像，基础镜像默认所有租户均可使用。默认提供的镜像包括 Centos 6.5 64 、Centos 7.4 64 、Centos 8.3 64、Debian10.12 64、Windows 2008r2 64 、Windows 2012r2 64 、Windows 2016r2 64 、Windows 2019r2 64 、Ubuntu 14.04 64 、Ubuntu 16.04 64、Ubuntu 20.04 64。

支持管理将租户自制或导入的镜像复制为基础镜像，作为默认基础镜像共享给平台所有租户使用；同时支持管理员修改基础镜像的名称备注及删除基础镜像。

#### 5.3.1.1 查看基础镜像

在基础镜像列表可查看平台所有基础镜像及镜像信息，包括名称、资源 ID、系统类型、操作系统状态、创建时间及操作项，如下图所示：

![baseimagelist](../images/adminguide/baseimagelist.png)

- 镜像名称：镜像的标识名称，创建虚拟机时展示在镜像列表中的标识。
- 资源 ID：镜像文件在平台的唯一标识符。
- 系统类型：镜像文件的操作系统类型，包括 Linux、Windows 等。
- 操作系统：镜像文件的 Base 操作系统版本，如 CentOS 6.5 x86_64。
- 创建时间：镜像创建的时间。
- 状态：基础镜像的状态，包括制作中、可用、删除中。
  - 制作中：指基础镜像正在被制作中，通过自制镜像复制基础镜像时会展示为制作中。
  - 可用：指镜像可被租户使用并可正常创建虚拟机。
  - 删除中：指镜像被删除中。

管理员可通过基础镜像列表对镜像进行删除操作，支持批量删除；同时为方便管理运维，支持搜索基础镜像。

#### 5.3.1.2 删除基础镜像

可以通过删除基础镜像下线平台不需要使用的基础镜像，仅支持删除可用状态的基础镜像，如下图所示：

![rmbaseimage](../images/adminguide/rmbaseimage.png)

**如果平台存在通过此基础镜像创建的虚拟机，则基础镜像无法被删除。**

#### 5.3.1.3 修改名称和备注

修改基础镜像的名称和备注，在任何状态下均可进行操作，可通过点击基础镜像列表页面每个镜像名称右侧的“编辑”按钮进行修改。

### 5.3.2 自制镜像管理

自制镜像由租户或管理员通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，除平台管理员外仅账号自身有权限查看和管理。

* 支持管理将为租户导入自定义镜像，并支持管理员将租户的虚拟机导出为自制镜像；同时管理员可下载镜像仓库中的所有自制镜像。

* 支持管理员通过自制镜像创建虚拟机、删除自制镜像、修改自制镜像名称。

为方便平台镜像模板文件的共享，平台支持管理员将一个自制镜像复制为一个基础镜像，使一个租户的自制镜像共享给所有租户使用，适用于运维部门制作模板镜像的场景，如自制镜像操作系统的漏洞修复或升级后，制作一个自制镜像并复制为基础镜像，使所有租户可使用新的镜像文件升级虚拟机系统。

#### 5.3.2.1 查看自制镜像

在自制镜像列表可查看平台所有租户在一个地域内的自制镜像列表信息，包括镜像名称、资源 ID、所属租户、系统类型、操作系统、状态及操作项，如下图所示：

![customeimage](../images/adminguide/customeimage.png)

- 镜像名称：自制镜像的标识名称。

- 资源 ID：自制镜像在平台的唯一标识符。

- 所属租户：自制镜像所归属的租户的主账号的邮箱和 ID。

- 系统类型：自制镜像的操作系统类型，包括 Linux 和 Windows 等。

- 操作系统：自制镜像的 Base 操作系统版本，如 CentOS 6.5 x86_64。

- 创建时间：自制镜像创建的时间。

- 状态：自制镜像的状态，包括创建中、可用、删除中、上传中、上传失败。
  - 创建中：指正在通过虚拟机制作自制镜像。
  - 可用：指自制镜像可被租户使用并可正常创建虚拟机。
  - 删除中：自制镜像正在被删除中。
  - 导入中：指自制镜像正在导入中或上传中。
  - 导入失败：指自制镜像导入失败。

管理员可通过自制镜像列表对单个自制镜像进行操作，包括创建虚拟机、复制为基础镜像、下载镜像及删除镜像，支持批量删除；同时支持管理员为某一个租户导入自定义镜像。

#### 5.3.2.2 导入自制镜像

导入镜像是指租户或平台管理员将第三方业务虚拟机以镜像的方式迁移到平台镜像仓库，使租户可以在通过导入的镜像创建并部署业务虚拟机，是用户将业务迁移的重要通道。

支持用户导入 Linux 和 Windows 发行版及自定义镜像，并支持 X86 架构和 aarch64 两种系统架构镜像的导入；云平台的镜像格式默认为 RAW ，用户上传 VHD、VMDK、QCOW2、OVA、ISO 等格式的镜像时，需先将镜像转换为 QCOW2 格式的镜像才可导入，有关转换镜像及自定义镜像的具体操作可参考自制镜像列表上展示的[自定义镜像指南](/UCloudStack_v2.x/customimage/README.md) 。 

制作好自定义镜像后，可通过镜像管理控制台资源列表上方的【导入镜像】功能，进入导入镜像向导页面：

![upimage](../images/adminguide/upimage.png)

- 租户邮箱：通过租户主账号邮箱选定自制镜像归属的租户。
- 镜像名称/备注：镜像的名称及相关备注信息。
- 导入方法：支持通过本地文件或 URL 导入 QCOW2 格式的镜像文件。
- 镜像地址：平台导入镜像时读取并下载镜像的 URL 地址，导入镜像时必须提供，平台会从提供的 URL 地址自动下载镜像并自动导入至镜像仓库，用于创建虚拟机。
  * 当前仅支持 HTTP、HTTPS 等协议的 URL 地址，格式包括 `https://path/file` 或`ftp://hostname[:port]/path/file` 或 `ftp://user:password@hostname[:port]/path/file` ；
  * 镜像的地址必须从云平台可达，即云平台组件可访问的 URL 地址，建议使用云平台相同外网的 IP 地址或外网 IP 地址可通信的地址。
- 操作系统：导入镜像的操作系统类型，包括 Linux 和 Windows ，需根据导入镜像 OS 类型进行选择；
- 系统架构：导入镜像的系统架构，包括 `x86_64` 和 `aarch64` ，需根据导入镜像进行选择；
- 系统平台：指导入镜像的操作系统平台；
  * Linux 操作系统的系统平台包括 Centos 、Debian和 Ubuntu ；
  * Windows 操作系统的系统平台仅支持 Windows ；
- 系统版本：当前需导入镜像的操作系统版本；
  * CentOS x86_64 架构支持  `6.5~6.10` 及 `7.0~7.9` 版本；
  * CentOS aarch64 架构支持 `7.6~7.9` 版本；
  * Debian x86_64 架构支持 10.12；
  * Ubuntu x86_64 架构支持 14.04 、 16.04 、18.04 和 20.04 版本；
  * Ubuntu aarch64 架构支持 16.04 和 18.04 版本；
  * Windows  支持 2008、2008R2、2012、2012R2 、2016 、2019 版本；
- 目标镜像大小：当前导入镜像的目标大小，最小 20GB ，最大不能超过 500GB ；
- SHA256 ：用于校验文件完整性的值，默认无需指定。

镜像导入后，自制镜像列表生成一条状态为 “导入中” 的镜像，由于平台需要先下载镜像至镜像仓库且镜像通常较大，导入镜像的时间通常比较长。

镜像状态转换为可用时，即代表镜像导入成功，可进行虚拟机创建、进行镜像下载及复制为基础镜像等操作；若镜像导入过程中出现意外导致失败，则镜像的状态会转换为“导入失败” ，可对失败的镜像进行删除并重新导入镜像。

> 导入镜像前需确保镜像地址可被访问且可读取并下载到镜像。

#### 5.3.2.3 创建虚拟机

管理员可从自制镜像为租户启动一台虚拟机，创建的虚拟机将归属于自制镜像所归属的租户，虚拟机中的程序及数据保持自制镜像的创建时的状态。

使用自制镜像创建虚拟机的过程与基础镜像相同，可根据提示进行操作。从镜像创建虚拟机时设置的管理员密码会覆盖原镜像操作系统中的密码，需使用新密码登录创建的虚拟机。	

#### 5.3.2.4 复制为基础镜像

为方便平台镜像模板文件的共享，平台支持管理员将一个自制镜像复制为一个基础镜像，使一个租户的自制镜像共享给所有租户使用，适用于运维部门制作模板镜像的场景，如自制镜像操作系统的漏洞修复或升级后，制作一个自制镜像并复制为基础镜像，使所有租户可使用新的镜像文件升级虚拟机系统。

若平台需要其它基础镜像系统，可先上传为自制镜像，再通过“复制为基础镜像”的功能转化为平台基础镜像。可通过目标自制镜像右侧“复制为自制镜像”操作，如下图所示：

![cloneimage](../images/adminguide/cloneimage.png)

输入目标基础镜像名称，即可触发复制为基础镜像的操作，自制镜像复制过程中会在基础镜像列表生成一条状态为【制作中】的基础镜像信息，待状态转换为【可用】时，代表复制成功，平台上的所有租户可使用此镜像创建虚拟机，进行业务部署。

#### 5.3.2.5 下载自制镜像

下载镜像指用户将平台自制的镜像下载至本地，用于备份或迁移。虚拟机镜像通过为 GB 级别文件，为保证下载镜像的断点续传等功能，平台以提供下载地址的方式支持镜像下载；可通过 FTP、 SFTP 及相关工具进行镜像下载，以保证断点续传功能，提升镜像下载的成功率。

管理员如果需要下载镜像至本地时，可通过自制镜像列表操作项中的【下载】进入镜像下载向导页面，如下图：

![downloadimage](../images/adminguide/downloadimage.png)

点击生成下载地址后，平台会跳转至下载地址展示向导页面，通过向导页面，用户通过复制下载地址链接，通过 HTTP、FTP 及相关下载工具下载镜像。

![downloadimage1](../images/adminguide/downloadimage1.png)

> 镜像下载地址有效期为 24 小时，需在 24 小时内进行镜像下载。若镜像下载地址过期，则无法进行下载，需到平台重新生成镜像下载地址。

#### 5.3.2.6 删除自制镜像

管理员可对自制镜像进行删除操作，被删除的自制镜像会自动进入所属租户的“**回收站**”，可通过回收站进行还原和销毁操作。管理员可通过自制镜像管理控制台的“删除”功能进行自制镜像的删除，删除后可到回收站中查看已删除的自制镜像，如下图所示：

![rmimage](../images/adminguide/rmimage.png)

仅支持删除状态为可用或导入失败的的自制镜像；若已通过自制镜像创建虚拟机，则不可删除自制镜像，需要将虚拟机删除，才可进行自制镜像的删除。

#### 5.3.2.7 修改名称和备注

修改自制镜像的名称和备注，在任何状态下均可进行操作。可通过点击自制镜像列表页面每个镜像名称右侧的“编辑”按钮进行修改。

## 5.4 外网网段管理

外网网段是平台对外通信的网络，一般由管理员或运维人员通过物理网络分配并配置至云平台。外网网段是平台为租户分配外网 IP （弹性 EIP）的 IP 资源池，支持 IPv4 和 IPv6 两种 IP 类型，并支持配置网段路由并自动下发路由至平台虚拟机。

平台在部署时默认为配置一段外网网段，如果平台业务需求，也可由管理员在管理控制台上自助添加 IP 网段，在添加 IP 网段前需要保证物理交换机上已为节点外网网络配置 Vlan 及相关网段信息。

网段管理仅作为平台管理员将物理网络上的网段信息录入至云平台，使云平台的租户可申请外网网段是的 IP 地址作为虚拟资源的外网 IP ，与平台外网进行通信。

支持管理员对外网 IP 的网段进行维护及管理，包括 IP 网段、网关、外网网卡、VLAN、路由及网段权限等配置，方便云平台管理员对外网 IP 地址池的管理，同时支持 IPv4 和 IPv6 双栈 IP 资源池管理。

* 支持通过私有 IP 地址段模拟外网网段，在交换机或上层路由将私有 IP 地址段 NAT 到互联网。
* 支持为每个网段配置路由策略，即租户申请网段的外网 IP 绑定至虚拟资源后，下发目的路由地址的流量自动以绑定的外网 IP 为网络出口。路由策略提供默认路由、指定路由及暂不指定三种模式：
  - 默认路由：即下发路由的目的地址为 0.0.0.0/0 ，代表默认所有流量均以绑定的外网 IP 为出口。
  - 指定路由：即管理员指定目的地址（如 10.0.2.0/24 ）的流量以绑定的外网 IP 为出口。
  - 暂不指定：即该网段不自动下发路由，仅可通过此外网 IP 地址与本网段进行通信。
* 支持管理员为云平台添加 IPv4 或 IPv4 版本的网段，使平台租户可同时申请 IPv4 和 IPv6 版本的外网 IP ，并绑定至虚拟机提供网络服务。
* 支持管理对每个网段的开放范围进行控制及修改，默认为所有租户（所有租户可申请并使用网段 IP），支持配置为部分租户（指定的租户才可申请并使用网段 IP，未指定租户无法查看并申请网段 IP）

为方便管理员和运维人员，平台提供外网网段的查看、修改等生命周期管理。外网网段中 IP 地址的带宽规格可参考全局配置中的【规格配置】

> 外网网段管理与平台部署的物理网络及架构拓扑紧密相关，在维护外网网段前需确保物理网络配置完善后，至平台录入 IP 网段后才可使用。

### 5.4.1 查看外网网段

管理员可通过外网网段控制台的列表查看已创建的外网网段的列表信息，包括网段 ID、名称、IP 版本、网段、网关、网卡、Vlan、租户权限、状态及更新时间，如下图所示：

![image](../images/adminguide/image.png)

租户权限中或指定所有租户展示为【所有租户】，若指定的为部分租户，则展示有权限的租户邮箱地址信息。

### 5.4.2 修改租户权限

当需要将一段外网网段独享给部分租户时，管理员可修改外网网段的租户权限，如下图所示：

![upnetauth](../images/adminguide/upnetauth.png)

修改租户权限后，无权限的租户即无法查看并使用外网网段的 IP 地址，但不影响已申请外网 IP 地址的使用，若租户释放了外网 IP ，则无法在申请该网段的  IP 地址。

