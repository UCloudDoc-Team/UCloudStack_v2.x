# 27 资源模板

## 27.1 概述

资源模版支持租户预定义创建资源的参数配置，保存到模版中，便于后续快速创建，以及结合水平弹性伸缩完成业务节点的快速阔缩。

## 27.2创建模版

### 27.2.1 创建虚拟机模板

云平台用户可以通过指定机型、规格、镜像、云硬盘、VPC 网络、公网 IP、安全组及虚拟机相关基础信息一键创建虚拟机模板，用于从模板创建虚拟机实例。虚拟机模板不占用实际资源。

1. 选择地域（数据中心）后，在左侧导航栏选择虚拟机模板，进入虚拟机模板控制台，点击“创建” ，弹出虚拟机模板创建向导；

   ![tbase_1](../images/userguide/tbase_1.png)

2. 选择虚拟机模板的机型，并确定虚拟机模板的操作系统镜像；

   * 机型是运行虚拟机的节点的集群类型，代表不同架构、不同型号的 CPU 或硬件特征，可由管理员自定义，如 x86 机型、GPU 机型、ARM 机型等，通过 ARM 机型创建的实例为 ARM 版虚拟机实例，已适配国产芯片、服务器及操作系统，并可运行国产化操作系统，如 UOS 或 银河麒麟。
   * 镜像即虚拟机实例运行环境的模板，可以选择基础镜像和自制镜像；
     * 基础镜像是由平台官方默认提供，包括多发行版 Centos 、Ubuntu 及 Windows 等原生操作系统，同时基础镜像的默认时区为上海。
     * 自制镜像由用户通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，仅账号自身有权限查看和管理。
   
3. 选择虚拟机模板的规格配置，即定义提供计算能力的 CPU 内存及 GPU 配置，规格可由平台管理员进行自定义；

   * CPU 机型默认提供 1 核 2G 、2 核 4G 、4 核 8G 、8 核 16G 、16 核 32G 及 64 核 128G 等虚机规格；
   * 平台提供 GPU 设备透传能力，若机型为 GPU 机型，可创建并运行拥有 GPU 能力的虚拟机；
   * 针对 GPU 机型，平台支持最高配置 4 颗 GPU 芯片，为使 GPU 虚拟机发挥最佳性能，平台限制最小 CPU内存规格为 GPU 颗数的 4 倍以上，如 1 颗 GPU 芯片最小需要 4 核 8G 规格，2 颗 GPU 芯片最小需要 8 核16G 规格，4 颗 GPU 芯片最小需要 16 核 32G 规格。

4. 选择并配置虚拟机模板的系统盘和数据盘，可分别配置系统盘和云硬盘的容量。

  * 系统盘：运行虚拟机镜像的系统盘，创建虚拟机模板时必须选择系统盘类型及系统盘容量；
      * 选择系统盘的磁盘类型，如 SSD 磁盘 或 HDD 磁盘，磁盘类型可由管理员进行自定义；
      * 配置系统盘容量，Linux 和 Windows 镜像默认系统盘均为 40GB ，支持扩容系统盘容量至 500GB，步长为 1GB ，即容量应为 1GB 的倍数 。

  * 数据盘：一种基于分布式存储系统为虚拟机提供持久化存储空间的弹性块设备，创建虚拟机模板配置一块云盘。
      * 数据盘挂载路径可选择默认为 `/data`（windows系统除外）。

5. 配置网络相关设置，包括 VPC 网络、子网、内网 IP 地址、内网安全组、外网 IP 及外网安全组等选项：

  ![tbase_2](../images/userguide/tbase_2.png)

  * VPC 网络是一个属于用户的、逻辑隔离的二层网络广播域环境。在一个 VPC 网络内，用户可以构建并管理多个三层网络，即子网（ Subnet ），VPC 私有网络是子网的容器，不同 VPC 间网络绝对隔离；
      * 创建虚拟机模板时必须选择 VPC 网络和所属子网；
      * 控制台已为用户计算所选子网的可用 IP 数量，创建时需指定可用 IP 数量足够的子网；
      * 安全组是平台提供的虚拟防火墙，提供出入双方向流量访问控制规则，定义哪些网络或协议能访问资源；
      * 外网安全组用于控制虚拟机南北向（外网 IP）的流量，内网安全组用于虚拟机东西向（网卡间）的安全访问控制；
      * 外网 IP 为虚拟机提供的弹性外网出口服务，平台支持 IPv4/IPv6  双栈网络。创建虚拟机模板时选中外网IP，可在虚拟机模板创建虚拟机时为虚拟机绑定一个外网 IP 地址。

6. 选择并配置虚拟机模板基础管理配置，包括登录方式、登录密码（可选择随机生成）和项目组信息等。

  ![tbase_3](../images/userguide/tbase_3.png)

  * 管理员名称：CentOS 的管理员为 `root` ，Ubuntu 的管理员为 `ubuntu` ，Windows 系统的管理员名称为  `administrator` ；
  * 登录方式：为虚拟机模板设置登录凭证，即登录虚拟机的密码，可选择随机生成； 

  选择的镜像既无cloud-init特性也无qemu-ga特性时，不支持设置密码，管理员名称、登录方式、管理员密码不展示。

7. 选择购买数量和付费方式，如下图所示确认订单并点击“立即购买” 进行虚拟机创建操作。

  ![tbase_4](../images/userguide/tbase_4.png)

  * 购买数量：固定为1；
  * 付费方式：选择虚拟机的计费方式，支持按时、按年、按月三种方式，可根据需求选择适合的付费方式；
  * 合计费用：用户选择虚拟机 CPU、内存、数据盘、外网 IP 等资源按照付费方式的费用展示；
  * 立即购买：点击立即购买后，会返回虚拟机模板列表页，不进行实际的扣费操作。从虚拟机模板创建虚拟机时需进行扣费操作。 


  ### 27.2.1.1 查看虚拟机模板详情信息

   在资源模板列表上点击模板名称进入模板详情页面，虚拟机模版包含基本信息、虚拟机配置、网络配置、存储配置、高级设置。

  ![vmtpinfo.png](../images/userguide/vmtpinfo.png)

  ### 27.2.1.2 创建资源
  在资源模版列表点击创建资源，设置资源名称，管理员密码，即可创建出对应配置的虚拟机。


## 27.3 查看资源模版列表

  资源模板列表页可查看当前账户下已有的资源模板，包括名称、资源 ID、状态，资源类型，项目，标签，操作等，同时也可通过“自定义列表”按钮，自定义列表所需信息。

  ![tlist](../images/userguide/tlist.png)

## 27.4 克隆模版
  在资源模版列表点击克隆模版，设置目标资源名称，即可克隆出相同配置的资源模版。

![clonetemp](../images/userguide/clonetemp.png)

## 27.5 更新模版
  在资源模版列表点击更新，打开更新资源模版页，更新要修改的配置点击立即购买，即可更新资源模版。

![updatetemp](../images/userguide/updatetemp.png)

## 27.6 修改标签
  在资源模版列表点击修改标签按钮，选择要修改的标签点击确认，即可更新资源模版的标签。

![updatetemptag](../images/userguide/updatetemptag.png)

## 27.7 删除资源模版

  在资源模版列表点击删除按钮，点击确认即可删除资源模版。资源模板已关联资源时不可删除，删除资源模板后对通过资源模板创建的资源无影响。

![deletetemp](../images/userguide/deletetemp.png)
