# 17 物理机纳管

## 17.1 产品简介

### 17.1.1 概述

物理机纳管（Physical Mechanical Nanotube）是平台为用户应用提供专属物理服务器的服务，可保证核心数据库、关键应用系统、高性能计算业务及暂时无法云化业务的高性能和稳定性。

结合云平台对资源的弹性管理，可实现物理机的按需分配、灵活申请、自动安装操作系统，同时结合 IPMI 和 PXE 可支持裸金属设备的批量部署，并通过自动化系统配置，实现远程批量启动和部署。支持自定义安装裸金属设备的操作系统及网络自助配置，并提供物理服务器生命周期管理，包括服务器的启动、关机及释放等。

平台通过部署服务器提供 PXE 远程自助装机服务，引导相同网络中多台物理服务器由 PXE 网络启动，通过部署服务器下载并安装操作系统软件包为物理机安装操作系统，并根据操作系统配置的网络模板信息，配置服务器网络信息，将服务器与平台外网网络打通，结合平台统一管理服务，使用户通过平台即可自助申请并管理物理服务器。具体价值举例如下：

* 通过裸金属服务，平台租户可将虚拟机和物理机混合部署，构建异构基础设施的统一管理和灵活组网，物理机的网络可与平台虚拟机的外网网络互通，满足虚拟机业务与物理机互访等场景的诉求。
* 租户可根据需求自助申请平台管理者提供的物理机，并独享物理服务器的计算、网络及本地磁盘资源，可充分满足对高性能、稳定性、数据安全性的要求；结合物理服务器的独享网络，可满足对网络的低时延和高吞吐业务场景。

租户通过申请平台的裸金属物理机，可应用于核心数据库、大数据服务及关键应用等应用场景，如可将数据库集群 OracleRAC 部署于裸金属服务，将业务应用部署于平台虚拟机，并使用虚拟机的外网 IP 与物理机直接通过物理设备进行互联，提升业务性能和稳定性的同时提升资源管理的便捷性。

### 17.1.2 使用流程

在使用物理机纳管服务前，必须提前准备好物理机设备，并根据需求将物理机服务器的 IPMI 网络及业务网络与平台网络进行打通，在通过平台录入设备信息，将设备分配给租户管理。物理机纳管服务的使用流程分为【平台管理员流程】和【租户流程】两大部分，其中前 6 步为平台管理员进行操作，具体如下：

1. **硬件环境装备**

   准备好硬件环境，配置物理网络交换机及服务器 IPMI 网络，使平台物理网络与 IPMI 网络可互相通信。

2. **为租户添加物理机**

   由【平台管理员】为租户添加物理机信息，包括服务器的名称、IPMI IP、IPMI User、IPMI PassWord、机架位置、标签及租户邮箱，支持批量导入物理机信息。

3. **PXE 引导初始化**

   物理机信息录入后，如果 IPMI 网络及登录信息可正常访问，平台将通过 IPMI 和 PXE 自动引导录入的物理机重新启动并进行平台准备好的部署系统并对服务器进行初始化。初始化过程中物理机的状态为【准备中】，待服务器初始化成功后，服务器的状态置为【正常】，此时可在物理机的详情中查看物理服务器的详细硬件配置，如 CPU、内存、磁盘信息、网卡信息等。

7. **租户添加物理机**

   由【平台租户】通过控制台物理机功能，根据需求自主添加物理机，包括服务器的名称、IPMI IP、IPMI User、IPMI PassWord、机架位置及标签，支持批量导入物理机信息。

9. **物理机管理**

   由【平台租户】对已申请的物理机进行全生命周期管理，支持开启、关机、重启、准备控制台、控制台登录、释放控制台、强制关机、关机并重新开机、更新物理机及删除，删除后的物理机可重新添加指定租户管理。

平台租户在使用裸金属服务的前提是物理机准备好并分配给租户，租户只需要简单的申请，即可便捷的使用平台提供的裸金属设备，并可灵活部署业务系统至裸金属，组建混合异构的基础设施环境。

## 17.2 添加物理机

在平台已提供物理机纳管服务时，租户的主账号和子账号可在平台上直接单独添加或批量导入物理机进行管理。用户可登录控制台，通过控制台导航栏【物理机】中的添加物理机操作进入向导页面，如下图所示：

![applybms](../images/userguide/applybms.png)

* 名称：指物理机在平台的名称标识，添加时必须指定。
* IPMI IP：指物理机的 IPMI IP 地址，添加时必须指定，IP 地址必须从平台可达
* IPMI User：物理机的 IPMI 用户名，添加时必须指定。
* IPMI PassWord：物理机的 IPMI 密码，添加时必须指定。
* 机架位置：物理机所处的机架位置，添加时必须指定。
* 标签：物理机的标签。

租户添加提交后列表将生成一条【资源准备中】的物理机信息，待添加成功后，会置为【运行】状态，此时用户可对物理机进行管理。

## 17.3 查看物理机

租户的主账号和拥有权限的子账号可通过物理机列表及详情查看账号下已添加的物理机信息及当前状态，如下图所示：

![bmslist](../images/userguide/bmslist.png)

* 名称/资源 ID：物理机的名称和全局资源唯一标识符。
* SN：物理机的整机序列号。
* IPMI IP：物理机的 IP 地址。
* 机型：物理机的机型。
* 机架位置：物理机所处的机架位置。
* 电源：物理机的电源状态，如开启、关机中、关机等。
* KVM状态：物理机控制台的状态，如未准备、准备中、就绪等。
* 创建时间：物理机的添加时间。
* 状态：当前物理机的资源状态，如运行、资源准备中等。

列表上的操作项中可对单台物理机进行开启、关机、重启、准备控制台、控制台登录、释放控制台、强制关机、关机并重新开机、更新物理机及删除等操作，支持批量删除物理机，其中删除后租户可重新进行添加。

租户也可通过列表上物理机的名称进入物理机的详情页面，查看物理机的详细信息，包括基本信息和配置信息：

* 基本信息包括：物理机的名称、ID、IPMI IP、SN 序列号及电源状态。
* 配置信息包括：物理机的 CPU 信息、内存信息及PCIE信息等。

## 17.4 物理机开机/关机

平台支持租户对已添加的物理机进行关机、开启、重启、强制关机、关机并重新开机操作，用于维护和管理物理机的生命周期。电源状态为开启时，才可执行关机、重启、强制关机、关机并重新开机操作；电源状态为关闭时，才可执行开启操作。

物理机开启过程中，物理机的电源状态为开机中，待开机成功后流转为开启；当用户触发关机时，物理机的状态为关机中，待关机成功后流转为关闭。

## 17.5 物理机控制台操作

租户可对物理机进行控制台操作，在控制台上对物理机进行生命周期管理。物理机KVM状态为未准备时，需执行准备控制台操作，执行完毕后，KVM状态流转为就绪；物理机KVM状态为就绪时，支持控制台登录和释放控制台。

## 17.6 更新物理机

租户可对已添加物理机进行更改机架位置和标签操作，更改完成后，机架位置和标签内容即时更新。

## 17.7 删除物理机

平台支持租户删除已添加的物理机，删除后可重新进行添加或由平台管理员重新添加给其它租户，物理机被删除后，会直接进行释放，不会进入回收站。

物理机删除并不会影响物理机内已运行的操作系统及业务服务。

