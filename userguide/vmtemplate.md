# 27 虚拟机模板

## 27.1 概述

虚拟机模板是提供了虚拟机的所有配置参数信息的模板，可快速地从模板启动可用的虚拟机实例。

## 27.2 创建虚拟机模板

云平台用户可以通过指定机型、规格、镜像、云硬盘、VPC 网络、公网 IP、安全组及虚拟机相关基础信息一键创建虚拟机模板，用于从模板创建虚拟机实例。虚拟机模板不占用实际资源。

1. 选择地域（数据中心）后，在左侧导航栏选择虚拟机模板，进入虚拟机模板控制台，点击“创建” ，弹出虚拟机模板创建向导；

   ![tbase_1](../images/userguide/tbase_1.png)

2. 选择虚拟机模板的机型，并确定虚拟机模板的操作系统镜像；

   * 机型是运行虚拟机的节点的集群类型，代表不同架构、不同型号的 CPU 或硬件特征，可由管理员自定义，如 x86 机型、GPU 机型、ARM 机型等，通过 ARM 机型创建的实例为 ARM 版虚拟机实例，已适配国产芯片、服务器及操作系统，并可运行国产化操作系统，如 UOS 或 银河麒麟。
   * 镜像即虚拟机实例运行环境的模板，可以选择基础镜像和自制镜像；
     * 基础镜像是由平台官方默认提供，包括多发行版 Centos 、Ubuntu 及 Windows 等原生操作系统，同时基础镜像的默认时区为上海。
     * 自制镜像由用户通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，仅账号自身有权限查看和管理。
   
3. 选择虚拟机模板的规格配置，即定义提供计算能力的 CPU 内存及 GPU 配置，规格可由平台管理员进行自定义；

   * CPU 机型默认提供 1 核 2G 、2 核 4G 、4 核 8G 、8 核 16G 、16 核 32G 及 64 核 128G 等虚机规格；
   * 平台提供 GPU 设备透传能力，若机型为 GPU 机型，可创建并运行拥有 GPU 能力的虚拟机；
   * 针对 GPU 机型，平台支持最高配置 4 颗 GPU 芯片，为使 GPU 虚拟机发挥最佳性能，平台限制最小 CPU内存规格为 GPU 颗数的 4 倍以上，如 1 颗 GPU 芯片最小需要 4 核 8G 规格，2 颗 GPU 芯片最小需要 8 核16G 规格，4 颗 GPU 芯片最小需要 16 核 32G 规格。

4. 选择并配置虚拟机模板的系统盘和数据盘，可分别配置系统盘和云硬盘的容量。

  * 系统盘：运行虚拟机镜像的系统盘，创建虚拟机模板时必须选择系统盘类型及系统盘容量；
      * 选择系统盘的磁盘类型，如 SSD 磁盘 或 HDD 磁盘，磁盘类型可由管理员进行自定义；
      * 配置系统盘容量，Linux 和 Windows 镜像默认系统盘均为 40GB ，支持扩容系统盘容量至 500GB，步长为 1GB ，即容量应为 1GB 的倍数 。

  * 数据盘：一种基于分布式存储系统为虚拟机提供持久化存储空间的弹性块设备，创建虚拟机模板配置一块云盘。
     * 数据盘挂载路径可选择默认为 `/data`（windows系统除外）。

5. 配置网络相关设置，包括 VPC 网络、子网、内网 IP 地址、内网安全组、外网 IP 及外网安全组等选项：

  ![tbase_2](../images/userguide/tbase_2.png)

  * VPC 网络是一个属于用户的、逻辑隔离的二层网络广播域环境。在一个 VPC 网络内，用户可以构建并管理多个三层网络，即子网（ Subnet ），VPC 私有网络是子网的容器，不同 VPC 间网络绝对隔离；
      * 创建虚拟机模板时必须选择 VPC 网络和所属子网；
      * 控制台已为用户计算所选子网的可用 IP 数量，创建时需指定可用 IP 数量足够的子网；
      * 安全组是平台提供的虚拟防火墙，提供出入双方向流量访问控制规则，定义哪些网络或协议能访问资源；
      * 外网安全组用于控制虚拟机南北向（外网 IP）的流量，内网安全组用于虚拟机东西向（网卡间）的安全访问控制；
      * 外网 IP 为虚拟机提供的弹性外网出口服务，平台支持 IPv4/IPv6  双栈网络。创建虚拟机模板时选中外网IP，可在虚拟机模板创建虚拟机时为虚拟机绑定一个外网 IP 地址。

6. 选择并配置虚拟机模板基础管理配置，包括登录方式、登录密码（可选择随机生成）和项目组信息等。

  ![tbase_3](../images/userguide/tbase_3.png)

  * 管理员名称：CentOS 的管理员为 `root` ，Ubuntu 的管理员为 `ubuntu` ，Windows 系统的管理员名称为  `administrator` ；
  * 登录方式：为虚拟机模板设置登录凭证，即登录虚拟机的密码，可选择随机生成； 

  选择的镜像既无cloud-init特性也无qemu-ga特性时，不支持设置密码，管理员名称、登录方式、管理员密码不展示。

7. 选择购买数量和付费方式，如下图所示确认订单并点击“立即购买” 进行虚拟机创建操作。

  ![tbase_4](../images/userguide/tbase_4.png)

  * 购买数量：固定为1；
  * 付费方式：选择虚拟机的计费方式，支持按时、按年、按月三种方式，可根据需求选择适合的付费方式；
  * 合计费用：用户选择虚拟机 CPU、内存、数据盘、外网 IP 等资源按照付费方式的费用展示；
  * 立即购买：点击立即购买后，会返回虚拟机模板列表页，不进行实际的扣费操作。从虚拟机模板创建虚拟机时需进行扣费操作。 

  ## 27.2 查看虚拟机模板

   通过导航栏进入虚拟机模板页面，可查看虚拟机模板的列表，通过列表上的名称，可进入虚拟机模板详情，查看虚拟机模板及相关资源的详细信息。

  ### 27.2.1 虚拟机模板列表

   虚拟机模板列表页可查看当前账户下已有的虚拟机模板，包括名称、资源 ID、VPC、子网、集群、配置、关联资源、计费方式、集群与特性、项目组及操作等，同时也可通过“自定义列表”按钮，自定义列表所需信息。

   ![tlist](../images/userguide/tlist.png)

   * 名称：虚拟机模板名称
   * 资源ID：虚拟机模板ID
   * VPC：虚拟机模板绑定的VPC ID
   * 子网：虚拟机模板绑定的子网ID
   * 集群：虚拟机模板的集群信息
   * 配置：虚拟机模板的配置信息
   * 关联资源：虚拟机模板绑定的资源ID
   * 计费方式：虚拟机模板选择的计费方式
   * 集群与特性：虚拟机模板的集群类型和镜像特性
   * 项目组：虚拟机模板绑定的项目组
   * 操作：虚拟机模板的操作项

  ### 27.2.2 虚拟机模板详情信息

   在虚拟机模板列表上点击模板名称进入模板详情页面，包含基本信息、虚拟机配置、网络配置、存储配置。

  #### 27.2.2.1 基本信息

  ![tdetail_1](../images/userguide/tdetail_1.png)

  * 资源ID：虚拟机模板ID
  * 资源名称：虚拟机模板名称
  * 关联资源：虚拟机模板关联的资源ID
  * 计费方式：虚拟机模板的计费方式

  #### 27.2.2.2 虚拟机配置

  ![tdetail_2](../images/userguide/tdetail_2.png)

  #### 27.2.2.3 网络配置

  ![tdetail_3](../images/userguide/tdetail_3.png)

  #### 27.2.2.4 存储配置

  ![tdetail_4](../images/userguide/tdetail_4.png)

  ## 27.3 从模板创建虚拟机

  虚拟机模板支持一键创建与模板相同配置信息的虚拟机实例。可从模板列表中创建虚拟机按钮或详情中创建虚拟机按钮创建虚拟机实例。

  ![tcreate](../images/userguide/tcreate.png)

  * 虚拟机模板：虚拟机模板ID
  * 虚拟机名称：默认虚拟机模板名称，可修改
  * 管理员密码：默认虚拟机模板密码，可修改
  * 合计费用：按虚拟机模板配置创建虚拟机所需的费用

  虚拟机模板所包含镜像既无cloud-init特性，也无qemu-ga特性时，不支持设置密码。从虚拟机模板创建的虚拟机登录密码为镜像密码。

  ## 27.4 删除模板

  平台用户可在控制台删除虚拟机模板，虚拟机模板已关联资源时不可删除，删除虚拟机模板后对通过虚拟机模板创建的虚拟机实例无影响。

  ![tdelete](../images/userguide/tdelete.png)

